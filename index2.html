<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Classroom Shark Tank Pitch Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-50 text-slate-900">
  <!-- Sticky Header (ONLY header stays fixed) -->
  <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
      <div class="h-10 w-10 rounded-2xl bg-slate-900 text-white grid place-items-center font-bold">ü¶à</div>
      <div class="flex-1">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h1 class="text-lg sm:text-xl font-bold leading-tight">Shark Tank Classroom Pitch Library</h1>
            <p class="text-xs sm:text-sm text-slate-600">Pick a pitch, read the script, and answer Shark questions.</p>
          </div>
          <button id="tipsBtn"
            class="shrink-0 inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 active:scale-[0.99]">
            üí° Tips
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Tips Panel (NOT sticky; it appears at top of scrollable content) -->
  <section id="tipsPanel" class="hidden">
    <div class="max-w-6xl mx-auto px-4 pt-4">
      <div class="rounded-2xl border border-slate-200 bg-white overflow-hidden">
        <div class="flex items-start justify-between gap-3 p-4 border-b border-slate-200">
          <div>
            <div class="text-base font-bold">üí° Pitch Tips (scrollable)</div>
            <div class="text-xs text-slate-600">This panel is scrollable so it works great on mobile.</div>
          </div>
          <button id="tipsCloseBtn"
            class="shrink-0 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50">
            ‚úï
          </button>
        </div>

        <!-- Scroll container -->
        <div class="max-h-[50vh] overflow-auto p-4 bg-slate-50">
          <pre id="tipsText" class="whitespace-pre-wrap text-sm leading-relaxed text-slate-900 font-medium"></pre>
        </div>

        <div class="p-4 border-t border-slate-200 flex flex-col sm:flex-row gap-2 sm:justify-end bg-white">
          <button id="tipsCopyBtn"
            class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50">
            üìã Copy tips
          </button>
          <button id="tipsScrollBtn"
            class="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold hover:bg-slate-800">
            ‚¨áÔ∏è Continue
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Everything else scrolls normally -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- What Sharks Ask (CLICKABLE) -->
    <section class="rounded-2xl border border-slate-200 bg-white p-4">
      <div class="text-sm font-semibold mb-2">What Sharks Ask (tap a question):</div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm">
        <button data-q="business" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ What is your business?
          <div class="text-xs text-slate-500">What do you sell or do?</div>
        </button>
        <button data-q="customers" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ Who will buy it?
          <div class="text-xs text-slate-500">Target customers</div>
        </button>
        <button data-q="startupCost" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ Cost to start?
          <div class="text-xs text-slate-500">What you must buy first</div>
        </button>
        <button data-q="sellingPrice" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ Selling price?
          <div class="text-xs text-slate-500">How much customers pay</div>
        </button>
        <button data-q="whySucceed" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ Why will it succeed?
          <div class="text-xs text-slate-500">Why people will choose you</div>
        </button>
        <button data-q="investorProfit" class="qaChip rounded-xl bg-slate-50 border border-slate-200 p-2 text-left hover:bg-slate-100 active:scale-[0.99]">
          ‚úÖ How investors profit?
          <div class="text-xs text-slate-500">How Sharks get paid back</div>
        </button>
      </div>

      <div class="mt-2 text-xs text-slate-600">
        Tip: select a pitch first ‚Äî then these questions show that pitch‚Äôs answers.
      </div>
    </section>

    <!-- Controls -->
    <section class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 rounded-2xl border border-slate-200 bg-white p-4">
        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
          <div class="flex-1">
            <label class="text-xs font-semibold text-slate-600">Search pitches</label>
            <div class="mt-1 relative">
              <input id="searchInput" type="text" placeholder="Search by name, type, or keywords..."
                     class="w-full rounded-2xl border border-slate-200 px-4 py-3 pr-10 outline-none focus:ring-2 focus:ring-slate-900/10" />
              <div class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">üîé</div>
            </div>
          </div>

          <div class="sm:w-52">
            <label class="text-xs font-semibold text-slate-600">Filter</label>
            <select id="typeFilter"
                    class="mt-1 w-full rounded-2xl border border-slate-200 px-3 py-3 outline-none focus:ring-2 focus:ring-slate-900/10">
              <option value="all">All types</option>
              <option value="Product">Product</option>
              <option value="Service">Service</option>
              <option value="Creative">Creative</option>
              <option value="Events">Events</option>
            </select>
          </div>
        </div>

        <div class="mt-4 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between">
          <div class="text-sm text-slate-600">
            <span id="countLabel" class="font-semibold text-slate-900">0</span> pitches shown
          </div>

          <div class="flex flex-wrap gap-2">
            <button id="exportBtn"
              class="inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold border border-slate-200 bg-white hover:bg-slate-50">
              ‚¨áÔ∏è Export JSON
            </button>
            <label class="inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold border border-slate-200 bg-white hover:bg-slate-50 cursor-pointer">
              ‚¨ÜÔ∏è Import JSON
              <input id="importInput" type="file" accept="application/json" class="hidden"/>
            </label>
            <button id="resetBtn"
              class="inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800">
              ‚ôªÔ∏è Reset to Defaults
            </button>
          </div>
        </div>
      </div>

      <!-- Quick ROI Calculator -->
      <div class="rounded-2xl border border-slate-200 bg-white p-4">
        <div class="flex items-center justify-between gap-2">
          <h2 class="text-base font-bold">Quick ROI (Investor)</h2>
          <span class="text-xs rounded-full bg-slate-100 px-2 py-1 text-slate-700">optional</span>
        </div>
        <p class="mt-1 text-sm text-slate-600">
          Estimate investor return from profit & ownership.
        </p>

        <div class="mt-3 grid grid-cols-2 gap-2">
          <div>
            <label class="text-xs font-semibold text-slate-600">Total Profit (projected)</label>
            <input id="roiProfit" type="number" min="0" step="0.01" value="20"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600">Ownership %</label>
            <input id="roiEquity" type="number" min="0" max="100" step="1" value="20"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600">Investment $</label>
            <input id="roiInvest" type="number" min="0" step="0.01" value="10"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600">Investor Return</label>
            <div id="roiOut"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 bg-slate-50 text-slate-900 font-semibold">
              $0.00
            </div>
          </div>
        </div>

        <div class="mt-2 text-sm text-slate-600">
          ROI %: <span id="roiPct" class="font-semibold text-slate-900">0%</span>
        </div>
      </div>
    </section>

    <!-- Pitches + Tracker -->
    <section class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Pitch List -->
      <div class="lg:col-span-2 rounded-2xl border border-slate-200 bg-white">
        <div class="p-4 border-b border-slate-200">
          <div class="flex items-center justify-between">
            <h2 class="text-base font-bold">Pitch List</h2>
            <span class="text-xs text-slate-600">Tap Script to read aloud ‚Ä¢ Tap Shark Questions for details</span>
          </div>
        </div>
        <div id="pitchList" class="p-3 sm:p-4 grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
      </div>

      <!-- Investment Tracker -->
      <div class="rounded-2xl border border-slate-200 bg-white p-4">
        <div class="flex items-center justify-between gap-2">
          <h2 class="text-base font-bold">Investor Notes & Bid Tracker</h2>
          <button id="clearTrackerBtn" class="text-xs font-semibold text-slate-600 hover:text-slate-900 underline">
            Clear
          </button>
        </div>

        <div class="mt-3">
          <label class="text-xs font-semibold text-slate-600">Selected pitch</label>
          <div id="selectedPitchLabel" class="mt-1 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm">
            None selected
          </div>
        </div>

        <div class="mt-3 grid grid-cols-2 gap-2">
          <div>
            <label class="text-xs font-semibold text-slate-600">Your Bid $</label>
            <input id="bidAmount" type="number" min="0" step="0.01" value="0"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600">Equity % asked</label>
            <input id="bidEquity" type="number" min="0" max="100" step="1" value="0"
              class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
          </div>
        </div>

        <div class="mt-3">
          <label class="text-xs font-semibold text-slate-600">Projected total profit (from pitch)</label>
          <input id="pitchProfitProjection" type="number" min="0" step="0.01" value="0"
            class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10" />
        </div>

        <div class="mt-3 rounded-2xl border border-slate-200 bg-slate-50 p-3">
          <div class="text-xs font-semibold text-slate-600">Potential Investor Return</div>
          <div id="trackerReturn" class="text-lg font-bold">$0.00</div>
          <div class="text-sm text-slate-600">ROI: <span id="trackerROI" class="font-semibold text-slate-900">0%</span></div>
        </div>

        <div class="mt-3">
          <label class="text-xs font-semibold text-slate-600">Investor notes (Why yes/no?)</label>
          <textarea id="investorNotes" rows="4" placeholder="Risk? Demand? Profit? Competition?"
            class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring-2 focus:ring-slate-900/10"></textarea>
        </div>

        <div class="mt-3 flex gap-2">
          <button id="saveDecisionBtn"
            class="flex-1 rounded-xl px-3 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800">
            Save Decision
          </button>
          <button id="exportTrackerBtn"
            class="rounded-xl px-3 py-2 text-sm font-semibold border border-slate-200 bg-white hover:bg-slate-50">
            Export Notes
          </button>
        </div>

        <div class="mt-3">
          <div class="text-xs font-semibold text-slate-600 mb-2">Saved decisions</div>
          <div id="decisionsList" class="space-y-2"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Backdrop -->
  <div id="modalBackdrop" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-slate-900/50"></div>
    <div class="absolute inset-0 flex items-end sm:items-center justify-center p-3 sm:p-6">
      <div class="w-full sm:max-w-2xl rounded-3xl bg-white shadow-xl border border-slate-200 overflow-hidden">
        <div class="flex items-start justify-between gap-3 p-4 border-b border-slate-200">
          <div>
            <div id="modalTitle" class="text-base sm:text-lg font-bold leading-tight">Modal Title</div>
            <div id="modalSubtitle" class="text-xs sm:text-sm text-slate-600">Modal subtitle</div>
          </div>
          <button id="modalCloseBtn"
            class="shrink-0 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50">
            ‚úï
          </button>
        </div>
        <div id="modalBody" class="p-4 max-h-[72vh] overflow-auto"></div>
        <div class="p-4 border-t border-slate-200 flex flex-col sm:flex-row gap-2 sm:justify-end">
          <button id="modalCopyBtn"
            class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50">
            üìã Copy text
          </button>
          <button id="modalOkBtn"
            class="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold hover:bg-slate-800">
            Done
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 hidden">
    <div class="rounded-2xl bg-slate-900 text-white px-4 py-2 text-sm shadow-lg">Copied!</div>
  </div>

<script>
/* ---------------------------
   Tip text (scrollable panel)
--------------------------- */
const TIPS_TEXT = `
PITCH TIPS (STUDENT-FRIENDLY)
1) Start with your business name and what you sell.
2) Say the problem first, then your solution.
3) Explain who will buy it (your customers).
4) Share simple numbers: cost, price, profit.
5) Ask for money and say what % you offer.
6) End confidently: ‚ÄúI‚Äôm ready for questions!‚Äù

INVESTOR QUESTION IDEAS
‚Ä¢ How will you advertise?
‚Ä¢ What if nobody buys it?
‚Ä¢ Who is your competition?
‚Ä¢ How will you improve the product?
‚Ä¢ How fast can you make more?
‚Ä¢ What‚Äôs your profit per sale?

PRACTICE
‚Ä¢ Read slowly and clearly.
‚Ä¢ Make eye contact with 1 person at a time.
‚Ä¢ If you mess up, pause and continue.

EXTRA STRONG LINES TO ADD
‚Ä¢ ‚ÄúWe are solving this problem by‚Ä¶‚Äù
‚Ä¢ ‚ÄúOur customers are‚Ä¶‚Äù
‚Ä¢ ‚ÄúIt costs us‚Ä¶ and we sell for‚Ä¶‚Äù
‚Ä¢ ‚ÄúWe are asking for‚Ä¶ for ‚Ä¶% ownership.‚Äù
`.trim();

/* ---------------------------
   Default pitch data
--------------------------- */
const DEFAULT_PITCHES = [
  {
    id: "snack-bundles",
    title: "Snack Attack Packs",
    type: "Product",
    keywords: ["snack", "candy", "chips", "bundles", "hungry"],
    business: "We sell snack bundles (chips + candy/gum) for quick, convenient snacks at school.",
    customers: "Students who get hungry between classes or want a cheaper option than vending machines.",
    startupCost: 15,
    unitCost: 0.50,
    sellingPrice: 1.50,
    whySucceed: "High demand, repeat customers, easy to restock, bundles feel like a deal.",
    investorProfit: "Investors earn a share of profit from every bundle sold (ownership percentage).",
    askMoney: 15,
    askEquity: 20,
    profitProjection: 20,
    script: [
      "Hello Sharks! My name is ____ and today I‚Äôm presenting my business called Snack Attack Packs.",
      "The problem is students often get hungry between classes and don‚Äôt want expensive vending prices.",
      "My solution is snack bundles that are quick to buy and easy to carry.",
      "It costs about $0.50 per item, and we sell bundles for $1.50, so profit is strong.",
      "Our customers are students who want convenient snacks, and we‚Äôll market with posters and word of mouth.",
      "We are asking for $15 for 20% ownership, and investors earn money from every bundle sold.",
      "Thank you Sharks ‚Äî I‚Äôm ready for questions!"
    ]
  },
  {
    id: "study-notes",
    title: "Study Notes Station",
    type: "Service",
    keywords: ["notes", "study guides", "flashcards", "tests"],
    business: "We create and sell study notes, quiz sheets, and flashcards for class topics.",
    customers: "Students who want quick study help before quizzes and tests.",
    startupCost: 8,
    unitCost: 0.15,
    sellingPrice: 1.00,
    whySucceed: "Students always need review materials; we can update notes for new topics.",
    investorProfit: "Investors earn a share of profits from each set of notes sold.",
    askMoney: 8,
    askEquity: 20,
    profitProjection: 12,
    script: [
      "Hello Sharks! I‚Äôm ____ and my business is Study Notes Station.",
      "The problem is students sometimes don‚Äôt know what to study or don‚Äôt have good notes.",
      "Our solution is clear study sheets, flashcards, and mini practice quizzes.",
      "Printing costs are low, and we sell each set for $1.",
      "Our customers are students preparing for quizzes and tests.",
      "We‚Äôre asking for $8 for 20% ownership, and investors profit from every study set sold.",
      "Thank you Sharks ‚Äî questions?"
    ]
  }
];

const STORAGE_KEY = "classroom_sharktank_pitches_v1";
const DECISIONS_KEY = "classroom_sharktank_decisions_v1";

let pitches = loadPitches();
let selectedPitchId = null;

/* ---------------------------
   Helpers
--------------------------- */
function money(n) {
  const x = Number(n || 0);
  return x.toLocaleString(undefined, { style: "currency", currency: "USD" });
}
function calcInvestorReturn(totalProfit, equityPct) {
  const p = Math.max(0, Number(totalProfit || 0));
  const e = Math.max(0, Math.min(100, Number(equityPct || 0)));
  return p * (e / 100);
}
function calcRoiPct(investment, investorReturn) {
  const inv = Math.max(0, Number(investment || 0));
  if (!inv) return 0;
  return ((Math.max(0, investorReturn) - inv) / inv) * 100;
}
function toast(msg="Copied!") {
  const t = document.getElementById("toast");
  t.querySelector("div").textContent = msg;
  t.classList.remove("hidden");
  setTimeout(()=>t.classList.add("hidden"), 900);
}
function escapeHtml(str) {
  return String(str ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}
function tagClass(type) {
  switch(type) {
    case "Service": return "bg-emerald-50 border-emerald-200 text-emerald-800";
    case "Product": return "bg-blue-50 border-blue-200 text-blue-800";
    case "Creative": return "bg-fuchsia-50 border-fuchsia-200 text-fuchsia-800";
    case "Events": return "bg-amber-50 border-amber-200 text-amber-900";
    default: return "bg-slate-50 border-slate-200 text-slate-700";
  }
}

/* ---------------------------
   Tips panel behavior
--------------------------- */
const tipsPanel = document.getElementById("tipsPanel");
const tipsTextEl = document.getElementById("tipsText");
tipsTextEl.textContent = TIPS_TEXT;

document.getElementById("tipsBtn").addEventListener("click", () => {
  tipsPanel.classList.toggle("hidden");
  if (!tipsPanel.classList.contains("hidden")) {
    // scroll tips panel into view (top of content)
    tipsPanel.scrollIntoView({ behavior: "smooth", block: "start" });
  }
});
document.getElementById("tipsCloseBtn").addEventListener("click", () => tipsPanel.classList.add("hidden"));
document.getElementById("tipsScrollBtn").addEventListener("click", () => {
  // close tips and continue
  tipsPanel.classList.add("hidden");
  window.scrollBy({ top: 250, behavior: "smooth" });
});
document.getElementById("tipsCopyBtn").addEventListener("click", async () => {
  try { await navigator.clipboard.writeText(TIPS_TEXT); toast("Tips copied!"); }
  catch { toast("Copy blocked"); }
});

/* ---------------------------
   Persistence
--------------------------- */
function loadPitches() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return structuredClone(DEFAULT_PITCHES);
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed) || parsed.length === 0) return structuredClone(DEFAULT_PITCHES);
    return parsed;
  } catch { return structuredClone(DEFAULT_PITCHES); }
}
function savePitches() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(pitches, null, 2));
}
function loadDecisions() {
  try {
    const raw = localStorage.getItem(DECISIONS_KEY);
    if (!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  } catch { return []; }
}
function saveDecisions(list) {
  localStorage.setItem(DECISIONS_KEY, JSON.stringify(list, null, 2));
}

/* ---------------------------
   Rendering pitches (same as before, minimal)
--------------------------- */
function renderPitches() {
  const listEl = document.getElementById("pitchList");
  listEl.innerHTML = "";

  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  const filter = document.getElementById("typeFilter").value;

  const filtered = pitches.filter(p => {
    const matchesFilter = (filter === "all") || (p.type === filter);
    const blob = [p.title, p.type, ...(p.keywords||[]), p.business, p.customers].join(" ").toLowerCase();
    const matchesQuery = !q || blob.includes(q);
    return matchesFilter && matchesQuery;
  });

  document.getElementById("countLabel").textContent = filtered.length;

  filtered.forEach(p => {
    const selected = p.id === selectedPitchId;
    const card = document.createElement("div");
    card.className = [
      "rounded-2xl border bg-white p-4 shadow-sm hover:shadow transition",
      selected ? "border-slate-900 ring-2 ring-slate-900/10" : "border-slate-200"
    ].join(" ");

    card.innerHTML = `
      <div class="flex items-start justify-between gap-2">
        <div>
          <div class="flex items-center gap-2">
            <div class="text-sm font-bold">${escapeHtml(p.title)}</div>
            <span class="text-[11px] rounded-full border px-2 py-0.5 ${tagClass(p.type)}">${escapeHtml(p.type)}</span>
          </div>
          <div class="mt-1 text-xs text-slate-600">
            Ask: <span class="font-semibold">${money(p.askMoney)}</span> for <span class="font-semibold">${Number(p.askEquity||0)}%</span>
            ‚Ä¢ Start: <span class="font-semibold">${money(p.startupCost)}</span>
          </div>
        </div>

        <button class="selectBtn shrink-0 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold hover:bg-slate-50">
          ${selected ? "Selected" : "Select"}
        </button>
      </div>

      <div class="mt-3 flex flex-col sm:flex-row gap-2">
        <button class="scriptBtn flex-1 rounded-xl bg-slate-900 text-white px-3 py-2 text-sm font-semibold hover:bg-slate-800">
          üé§ Read Script
        </button>
        <button class="infoBtn flex-1 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50">
          üìå Shark Questions
        </button>
      </div>

      <div class="mt-3 text-xs text-slate-600 line-clamp-3">
        ${escapeHtml(p.business)}
      </div>
    `;

    card.querySelector(".selectBtn").addEventListener("click", () => selectPitch(p.id));
    card.querySelector(".scriptBtn").addEventListener("click", () => openScriptModal(p.id));
    card.querySelector(".infoBtn").addEventListener("click", () => openInfoModal(p.id));

    listEl.appendChild(card);
  });
}

function selectPitch(id) {
  selectedPitchId = id;
  const p = pitches.find(x => x.id === id);
  document.getElementById("selectedPitchLabel").textContent = p ? `${p.title} (${p.type})` : "None selected";
  document.getElementById("bidAmount").value = p ? p.askMoney : 0;
  document.getElementById("bidEquity").value = p ? p.askEquity : 0;
  document.getElementById("pitchProfitProjection").value = p ? p.profitProjection : 0;
  updateTrackerROI();
  renderPitches();
}

/* ---------------------------
   Modal (for scripts and questions)
--------------------------- */
const modalBackdrop = document.getElementById("modalBackdrop");
const modalTitle = document.getElementById("modalTitle");
const modalSubtitle = document.getElementById("modalSubtitle");
const modalBody = document.getElementById("modalBody");
const modalCloseBtn = document.getElementById("modalCloseBtn");
const modalOkBtn = document.getElementById("modalOkBtn");
const modalCopyBtn = document.getElementById("modalCopyBtn");
let currentModalCopyText = "";

function openModal({title, subtitle, bodyHtml, copyText}) {
  modalTitle.textContent = title;
  modalSubtitle.textContent = subtitle || "";
  modalBody.innerHTML = bodyHtml || "";
  currentModalCopyText = copyText || "";
  modalBackdrop.classList.remove("hidden");
  document.body.classList.add("overflow-hidden");
  setTimeout(()=>modalCloseBtn.focus(), 0);
}
function closeModal() {
  modalBackdrop.classList.add("hidden");
  document.body.classList.remove("overflow-hidden");
}
modalCloseBtn.addEventListener("click", closeModal);
modalOkBtn.addEventListener("click", closeModal);
modalBackdrop.addEventListener("click", (e) => { if (e.target === modalBackdrop) closeModal(); });
document.addEventListener("keydown", (e) => { if (!modalBackdrop.classList.contains("hidden") && e.key === "Escape") closeModal(); });
modalCopyBtn.addEventListener("click", async () => {
  if (!currentModalCopyText) return toast("Nothing to copy");
  try { await navigator.clipboard.writeText(currentModalCopyText); toast("Copied!"); }
  catch { toast("Copy blocked"); }
});

function openScriptModal(pitchId) {
  const p = pitches.find(x => x.id === pitchId);
  if (!p) return;
  const scriptText = (p.script || []).map((line, idx) => `${idx+1}. ${line}`).join("\n");
  openModal({
    title: `üé§ Script: ${p.title}`,
    subtitle: "Read this out loud as your pitch.",
    bodyHtml: `
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
        <pre class="whitespace-pre-wrap text-sm leading-relaxed text-slate-900 font-medium">${escapeHtml(scriptText)}</pre>
      </div>
    `,
    copyText: scriptText
  });
}

function qaBlock(label, value) {
  return `
    <div class="rounded-2xl border border-slate-200 p-4">
      <div class="text-xs font-semibold text-slate-600">${escapeHtml(label)}</div>
      <div class="mt-1 text-sm text-slate-900 leading-relaxed">${escapeHtml(value)}</div>
    </div>
  `;
}

function openInfoModal(pitchId) {
  const p = pitches.find(x => x.id === pitchId);
  if (!p) return;
  const qas = `
What is your business?
${p.business}

Who will buy it?
${p.customers}

Cost to start?
${money(p.startupCost)}

Selling price?
${money(p.sellingPrice)} per sale

Why will it succeed?
${p.whySucceed}

How investors profit?
${p.investorProfit}
`.trim();

  openModal({
    title: `üìå Shark Questions: ${p.title}`,
    subtitle: "These are the answers Sharks expect to hear.",
    bodyHtml: `
      <div class="grid grid-cols-1 gap-3">
        ${qaBlock("What is your business?", p.business)}
        ${qaBlock("Who will buy it?", p.customers)}
        ${qaBlock("Cost to start?", `${money(p.startupCost)} (startup cost)`)}
        ${qaBlock("Selling price?", `${money(p.sellingPrice)} per sale`)}
        ${qaBlock("Why will it succeed?", p.whySucceed)}
        ${qaBlock("How investors profit?", p.investorProfit)}
      </div>
    `,
    copyText: qas
  });
}

/* Clickable top questions -> pop selected pitch answer */
function openTopQuestion(qKey) {
  const p = pitches.find(x => x.id === selectedPitchId);
  if (!p) {
    openModal({
      title: "Select a pitch first",
      subtitle: "",
      bodyHtml: `<div class="text-sm text-slate-700">Tap <span class="font-semibold">Select</span> on a pitch card, then tap a Shark question.</div>`,
      copyText: ""
    });
    return;
  }

  const map = {
    business: { label: "What is your business?", value: p.business },
    customers: { label: "Who will buy it?", value: p.customers },
    startupCost: { label: "Cost to start?", value: `${money(p.startupCost)} (startup cost)` },
    sellingPrice: { label: "Selling price?", value: `${money(p.sellingPrice)} per sale` },
    whySucceed: { label: "Why will it succeed?", value: p.whySucceed },
    investorProfit: { label: "How investors profit?", value: p.investorProfit }
  };
  const item = map[qKey] || map.business;

  openModal({
    title: `‚úÖ ${item.label}`,
    subtitle: `Selected pitch: ${p.title}`,
    bodyHtml: `
      <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
        <div class="text-sm text-slate-900 leading-relaxed font-medium">${escapeHtml(item.value)}</div>
      </div>
    `,
    copyText: `${item.label}\n${item.value}`
  });
}
document.querySelectorAll(".qaChip").forEach(btn => {
  btn.addEventListener("click", () => openTopQuestion(btn.getAttribute("data-q")));
});

/* ---------------------------
   Export / Import
--------------------------- */
function download(filename, text) {
  const blob = new Blob([text], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}
document.getElementById("exportBtn").addEventListener("click", () => download("pitches.json", JSON.stringify(pitches, null, 2)));
document.getElementById("resetBtn").addEventListener("click", () => {
  pitches = structuredClone(DEFAULT_PITCHES);
  selectedPitchId = null;
  savePitches();
  renderPitches();
  selectPitch(pitches[0]?.id || null);
  toast("Reset!");
});
document.getElementById("importInput").addEventListener("change", async (e) => {
  const file = e.target.files && e.target.files[0];
  if (!file) return;
  try {
    const text = await file.text();
    const parsed = JSON.parse(text);
    if (!Array.isArray(parsed)) throw new Error("JSON must be an array of pitches");
    pitches = parsed;
    savePitches();
    renderPitches();
    selectPitch(pitches[0]?.id || null);
    toast("Imported!");
  } catch (err) {
    openModal({ title: "Import Error", subtitle: "", bodyHtml: `<div class="text-sm">${escapeHtml(err.message || err)}</div>`, copyText: "" });
  } finally {
    e.target.value = "";
  }
});
document.getElementById("searchInput").addEventListener("input", renderPitches);
document.getElementById("typeFilter").addEventListener("change", renderPitches);

/* ---------------------------
   ROI calculators
--------------------------- */
function updateQuickROI() {
  const profit = Number(document.getElementById("roiProfit").value || 0);
  const equity = Number(document.getElementById("roiEquity").value || 0);
  const inv = Number(document.getElementById("roiInvest").value || 0);
  const ret = calcInvestorReturn(profit, equity);
  const roi = calcRoiPct(inv, ret);
  document.getElementById("roiOut").textContent = money(ret);
  document.getElementById("roiPct").textContent = `${roi.toFixed(1)}%`;
}
["roiProfit","roiEquity","roiInvest"].forEach(id => document.getElementById(id).addEventListener("input", updateQuickROI));

function updateTrackerROI() {
  const bid = Number(document.getElementById("bidAmount").value || 0);
  const eq = Number(document.getElementById("bidEquity").value || 0);
  const projProfit = Number(document.getElementById("pitchProfitProjection").value || 0);
  const ret = calcInvestorReturn(projProfit, eq);
  const roi = calcRoiPct(bid, ret);
  document.getElementById("trackerReturn").textContent = money(ret);
  document.getElementById("trackerROI").textContent = `${roi.toFixed(1)}%`;
}
["bidAmount","bidEquity","pitchProfitProjection"].forEach(id => document.getElementById(id).addEventListener("input", updateTrackerROI));

/* Decisions list (kept minimal) */
function renderDecisions() {
  const list = loadDecisions();
  const el = document.getElementById("decisionsList");
  el.innerHTML = list.length ? "" : `<div class="text-sm text-slate-500">No saved decisions yet.</div>`;
}
document.getElementById("clearTrackerBtn").addEventListener("click", () => {
  document.getElementById("bidAmount").value = 0;
  document.getElementById("bidEquity").value = 0;
  document.getElementById("pitchProfitProjection").value = 0;
  document.getElementById("investorNotes").value = "";
  updateTrackerROI();
  toast("Cleared");
});

/* ---------------------------
   Init
--------------------------- */
savePitches();
renderPitches();
updateQuickROI();
renderDecisions();
selectPitch(pitches[0]?.id || null);
updateTrackerROI();
</script>
</body>
</html>
